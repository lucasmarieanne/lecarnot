RewriteEngine On

# ----------------------------------------------------------------------------
# üî• AUTO-DETECTION : LOCAL vs PRODUCTION
# ----------------------------------------------------------------------------

RewriteCond %{HTTP_HOST} ^localhost [NC,OR]
RewriteCond %{HTTP_HOST} ^127\.0\.0\.1 [NC]
RewriteRule ^ - [E=ENVIRONMENT:local]

RewriteRule ^ - [E=ENVIRONMENT:production]

# ----------------------------------------------------------------------------
# üî• BASE PATH automatiques
# ----------------------------------------------------------------------------

RewriteCond %{ENV:ENVIRONMENT} =local
RewriteRule ^ - [E=BASE_PATH:/projets-web/website-nicolas-sohier]

RewriteCond %{ENV:ENVIRONMENT} =production
RewriteRule ^ - [E=BASE_PATH:/]

# ----------------------------------------------------------------------------
# üö´ Interdire l'acc√®s direct √† certains dossiers/fichiers PHP
# ----------------------------------------------------------------------------

# Interdit l'acc√®s direct aux pages et composants (doivent passer par index.php)
RewriteRule ^(pages|components)/ - [F,L]

# Interdire acc√®s fichiers sensibles
<FilesMatch "\.(env|ini|log|bak|sql|sh|config\.php)$">
    Require all denied
</FilesMatch>

# D√©sactiver l'indexation des dossiers
Options -Indexes

# ----------------------------------------------------------------------------
# üõ°Ô∏è Headers de s√©curit√© (√† adapter si besoin)
# ----------------------------------------------------------------------------
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    # Active uniquement si ton site est en HTTPS en prod :
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# ----------------------------------------------------------------------------
# üî• ROUTING
# ----------------------------------------------------------------------------

# Si URL vide ‚Üí charger la home via index.php
RewriteRule ^$ index.php?page=home [L]

# Laisser passer fichiers existants
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Router PHP
RewriteRule ^([a-zA-Z0-9-_]+)/?$ index.php?page=$1 [QSA,L]
